{% load fieldtype %}

{% for hidden in form.hidden_fields %}
  {{ hidden }}
{% endfor %}
{% for field in form.visible_fields %}
  {% if not fields or field.name in fields %}
  <div class="{% if field.errors%}error{%endif%}">
    <div class="control-group {% if field.errors %}error{% endif %}">
        {% if field|fieldtype:'checkboxinput' %}
          <div class="controls">
            <label class="checkbox">
              {{field}}
              {{field.label}}
              {% if field.errors %}
                <span class="help-inline pull-right">
                  {% for error in field.errors %}
                    {{ error }}
                  {% endfor %}
                </span>
              {% endif %}
              <span class="help-block">
                {{ field.help_text }}
              </span>
            </label>
          </div>
        {% elif field|fieldtype:'checkboxselectmultiple' %}
          <label class="control-label" for="{{field.id_for_label}}">{{field.label}}</label>
          <div class="controls" id="{{field.id_for_label}}">
            {% for optionid, optionval in field.field.choices %}
              <label class="checkbox">
                <input type="checkbox" name="{{field.name}}"
                       value="{{optionid}}"
                       {% if optionid in field.value %}checked="checked"{% endif %}>
                       {{optionval}}
              </label>
            {% endfor %}
            {% if field.errors %}
              <span class="help-inline pull-right">
                {% for error in field.errors %}
                  {{ error }}
                {% endfor %}
              </span>
            {% endif %}
            <span class="help-block">
              {{ field.help_text }}
            </span>
          </div>
        {% elif field|fieldtype:'radioselect' %}
          <label class="control-label" for="{{field.id_for_label}}">{{field.label}}</label>
          <div class="controls" id="{{field.id_for_label}}">
            {% for optionid, optionval in field.field.choices %}
              <label class="radio">
                <input type="radio" name="{{field.name}}"
                       value="{{optionid}}"
                       {% if optionid == field.value %}checked="checked"{% endif %}>
                       {{optionval}}
              </label>
            {% endfor %}
            {% if field.errors %}
              <span class="help-inline pull-right">
                {% for error in field.errors %}
                  {{ error }}
                {% endfor %}
              </span>
            {% endif %}
            <span class="help-block">
              {{ field.help_text }}
            </span>
          </div>
        {% else %}
          <label class="control-label" for="{{field.id_for_label}}">{{field.label}}</label>
          <div class="controls">
            {{ field }}
            {% if field.help_text %}
              <span class="help-block">
                {{ field.help_text }}
              </span>
            {% endif %}
            {% if field.errors %}
              <span class="help-inline pull-right">
                {% for error in field.errors %}
                  {{ error }}
                {% endfor %}
              </span>
            {% endif %}
          </div>
        {% endif %}
    </div>
  </div>
  {% endif %}
{% endfor %}
